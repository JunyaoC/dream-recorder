graph TD
    %% Hardware Components
    subgraph Hardware["Hardware Components"]
        TS[Touch Sensor TTP223B]
        MIC[USB Microphone]
        RPI[Raspberry Pi 5]
        SCRN[Display Screen]
        GPIO[GPIO Pins]
    end
    
    %% Software Components
    subgraph Software["Software Components"]
        %% Backend Components
        subgraph Backend["Backend (Python)"]
            FLASK[Flask Web Server]
            WS[WebSocket Server]
            GP_CTRL[GPIO Controller]
            AUDIO_PROC[Audio Processor]
            API_CLIENT[API Client]
            FFMPEG[FFmpeg Video Processor]
            DB[State Management]
        end
        
        %% Frontend Components
        subgraph Frontend["Frontend (HTML/JS/CSS)"]
            UI[User Interface]
            AUDIO_REC[Audio Recorder]
            WS_CLIENT[WebSocket Client]
            VID_PLAYER[Video Player]
            STATE_MGR[State Manager]
        end
    end
    
    %% External Services
    subgraph External["External Services"]
        OPENAI_STT[OpenAI STT API]
        OPENAI_PROMPT[OpenAI Prompt API]
        LUMALABS[LumaLabs Video API]
    end
    
    %% Hardware Connections
    TS --> GPIO
    GPIO --> RPI
    MIC --> RPI
    RPI --> SCRN
    
    %% Software Connections
    GPIO --> GP_CTRL
    GP_CTRL --> FLASK
    
    %% Backend Connections
    FLASK --> WS
    FLASK --> API_CLIENT
    WS --> AUDIO_PROC
    AUDIO_PROC --> API_CLIENT
    API_CLIENT --> DB
    API_CLIENT --> FFMPEG
    FFMPEG --> DB
    
    %% Frontend-Backend Connections
    FLASK --> UI
    WS <--> WS_CLIENT
    
    %% Frontend Internal Connections
    UI --> AUDIO_REC
    UI --> VID_PLAYER
    UI --> STATE_MGR
    AUDIO_REC --> WS_CLIENT
    STATE_MGR --> UI
    
    %% External API Connections
    API_CLIENT --> OPENAI_STT
    API_CLIENT --> OPENAI_PROMPT
    API_CLIENT --> LUMALABS
    
    %% Data Flow for Key Operations
    AUDIO_REC -- "Audio Stream" --> WS_CLIENT
    WS_CLIENT -- "WebSocket Audio Data" --> WS
    WS -- "Audio Data" --> AUDIO_PROC
    AUDIO_PROC -- "Audio Data" --> API_CLIENT
    API_CLIENT -- "Audio for STT" --> OPENAI_STT
    OPENAI_STT -- "Transcribed Text" --> API_CLIENT
    API_CLIENT -- "Text for Prompt" --> OPENAI_PROMPT
    OPENAI_PROMPT -- "Video Prompt" --> API_CLIENT
    API_CLIENT -- "Video Prompt" --> LUMALABS
    LUMALABS -- "Video URL" --> API_CLIENT
    API_CLIENT -- "Raw Video" --> FFMPEG
    FFMPEG -- "Processed Video" --> API_CLIENT
    API_CLIENT -- "Processed Video" --> FLASK
    FLASK -- "Video Path" --> UI
    UI -- "Video Path" --> VID_PLAYER
    VID_PLAYER -- "Video" --> SCRN 